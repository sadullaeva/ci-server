# Тесты

Убедитесь, что используете Node.js 12.16.1.

Убедитесь, что выполнены инструкции из [README.md](README.md).

## Как запустить модульные тесты

1. Установите все зависимости командой `make install-dependencies`
2. Выполните команду `make run-unit-tests`

## Как запустить интеграционные тесты

Простой способ (если у вас есть установленный docker):
1. В одной вкладке терминала запустить `make docker-run` и дождаться, пока все поднимется
2. В другой вкладке терминала запустить `make docker-test`

Способ сложнее:
1. Выполнить [hermione prerequisites](https://github.com/gemini-testing/hermione/blob/master/README.md#prerequisites)
2. Выполнить `make install-all-dependencies`
3. В четырех разных вкладках терминала запустить команды:
    * `make run-server`
    * `make run-client`
    * `make run-selenium`
    * `make run-integration-tests`

## Модульные тесты

**Логические блоки приложения:**

* Клиентская часть
    * Точка входа в приложение `client/src/index.ts`
    * Компоненты `client/src/*.blocks`
    * Страницы `client/src/pages`
    * Хранилище `client/src/store`
    * Методы вызова API `client/src/api`
    * Компоненты Storybook `client/src/stories`
    * Утилиты `client/src/utils`
    * Документация `client/docs`

* Серверная часть
    * Точка входа в приложение `server/server.ts`
    * Роутинг `server/routes/api.ts`
    * Контроллеры `server/controllers`
    * Доступ к хранилищу `server/api`
    * Сервисы `server/services`
    * Утилиты `server/utils`
    * Документация API `server/swagger.json`

**Сценарии модульных тестов:**

* Клиентская часть
    * Главная страница возвращает историю билдов или пустую страницу в зависимости от того, заданы ли настройки в сторе
    * Страница истории билдов запрашивает билды при первом рендере
    * Кнопка Run build на странице истории билдов открывает диалог для ввода хеша коммита
    * Сабмит корректно заполненной формы для запуска билда диспатчит экшен с верными параметрами
    * Сабмит корректно заполненной формы настроек репозитория диспатчит экшен с верными параметрами
    * Страница билда запрашивает данные и лог билда при первом рендере
    * **TODO:** Кнопка Rebuild диспатчит экшен с верными параметрами
    * Утилиты для date работают корректно

* Серверная часть
    * CachedLog работает корректно
    * cloneRepo работает корректно
    * getCommitAuthorName работает корректно
    * getCommitMessage работает корректно
    * **TODO:** Контроллеры используют storageMethods с корректными параметрами

## Интеграционные тесты

**Сценарии интеграционных тестов (как я их видела изначально):**

* Добавление настроек на клиенте инициирует клонирование репозитория и сохранение настроек в БД
* Добавление коммита в очередь на сборку на клиенте инициирует добавление в очередь на бекенде
* Нажатие кнопки "Rebuild" на клиенте инициирует повторное добавление коммита в очередь на сборку на бекенде и перенаправляет на страницу нового билда

**Сценарии интеграционных тестов (как они получились):**

* Сохранение валидных настроек репозитория работает корректно
* Попытка сохранения невалидных настроек не удается, отображаются ошибки
* Нажатие кнопки "Run build" и отправка формы инициирует добавление коммита в очередь на сборку и перенаправляет на страницу нового билда
* **TODO:** Нажатие кнопки "Rebuild" на клиенте инициирует повторное добавление коммита в очередь на сборку и перенаправляет на страницу нового билда

## Выбор инструментов для тестов

Для модульных тестов клиентской части я использовала предустановленные create-react-app-ом Jest и React testing library.

Для модульных тестов клиентской части я выбрала комбинацию Mocha, Chai и Sinon.
Это те инструменты, о которых нам рассказывали в примерах на лекции, отчасти поэтому выбор пал на них, отчасти - потому что я их раньше не использовала, было интересно попробовать.

Для интеграционных тестов нам настоятельно рекомендовали использовать Selenium и Hermione, поэтому их я и использовала.
Hermione оказалась достаточно простая в использовании, но у нее, к сожалению, не очень развитое сообщество, гуглить что-то почти бесполезно.

Для удобного запуска приложения и тестов я добавила Docker и Makefile.
